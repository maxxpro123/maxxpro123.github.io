<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VR Movement with Pico Controllers</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <style>
    body { margin: 0; }
    a-scene { width: 100%; height: 100%; }
  </style>
</head>
<body>
  <a-scene>
    <!-- Игрок -->
    <a-entity id="player" position="0 1.6 0">
      <!-- Камера -->
      <a-entity camera look-controls></a-entity>

      <!-- Левый контроллер: перемещение -->
      <a-entity 
        pico-controls="hand: left" 
        thumbstick-movement></a-entity>

      <!-- Правый контроллер: взаимодействие через raycaster -->
      <a-entity 
        pico-controls="hand: right" 
        raycaster="objects: .collidable; showLine: true;"></a-entity>
    </a-entity>

    <!-- Пример объекта для взаимодействия -->
    <a-entity 
      class="collidable" 
      geometry="primitive: box" 
      material="color: red" 
      position="0 1 -3">
    </a-entity>

    <!-- Пол -->
    <a-plane position="0 0 -4" rotation="-90 0 0" width="100" height="100" color="#7BC8A4"></a-plane>
  </a-scene>

  <script>
    // Компонент для перемещения с помощью джойстика
    AFRAME.registerComponent('thumbstick-movement', {
      init: function () {
        this.el.addEventListener('thumbstickmoved', (evt) => {
          const player = document.querySelector('#player').object3D;

          // Получаем направление движения вперед
          const direction = new THREE.Vector3();
          player.getWorldDirection(direction);
          direction.y = 0; // Игнорируем вертикальное движение
          direction.normalize();

          // Получаем направление движения вправо
          const right = new THREE.Vector3();
          player.getWorldDirection(right);
          right.applyAxisAngle(new THREE.Vector3(0, 1, 0), Math.PI / 2); // Поворачиваем на 90 градусов
          right.normalize();

          // Рассчитываем движение вперед/назад и влево/вправо
          const forwardMovement = direction.multiplyScalar(evt.detail.y * 0.1); // Скорость по оси Y джойстика
          const rightMovement = right.multiplyScalar(evt.detail.x * 0.1); // Скорость по оси X джойстика

          // Суммируем движения
          const movement = forwardMovement.add(rightMovement);

          // Применяем движение к позиции игрока
          player.position.add(movement);
        });
      }
    });
  </script>
</body>
</html>
